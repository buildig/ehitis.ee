<!DOCTYPE HTML>
<html>

<head>
    <title>ehitis.ee</title>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css">
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.1.1/jquery.min.js"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/bootbox.js/4.4.0/bootbox.min.js"></script>
    <script src='https://api.mapbox.com/mapbox.js/plugins/turf/v1.3.0/turf.min.js'></script>
    <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/openlayers/2.13.1/OpenLayers.js" charset="UTF-8"></script>
    <script type="text/javascript" src=" http://inadstest.maaamet.ee/inaadress/js/editor.min.js"></script>

</head>

<body>
    <div id="kaart" style="width: 100%; height: 100%"></div>
    <script>
        var editor = new InAadressEditor({
            "container": "kaart",
            "hideLogo": true,
            "showScale": true,
            "tools": ["measure", ],
            "fullscreenMode": true,
            "appartment": 0,
            "searchLayers": ["EHAK", "TANAV", "KATASTRIYKSUS", "EHITISHOONE"],
            "defaultBaseLayer": "ALUSKAART",
            "baseLayers": ["ALUSKAART", "ORTOFOTO", "HYBRIID"],
            "mapLayers": ["AADRESS", "KATASTRIYKSUS"],
            "WMS": [],
            "format": "GeoJSON",
            "drawing": false,
            "geomType": "polygon",
            "multiGeom": false,
            "editStyle": {
                "fillColor": "#FF0000",
                "fillOpacity": "0.5",
                "strokeColor": "#000000",
                "strokeOpacity": "0.9",
                "strokeWidth": "2"
            }
        });

        document.addEventListener('featureAdded', function(e) {
            bootbox.alert({
                title: "GeoJSON",
                message: e.detail.feature
            });
        });
        document.addEventListener('featureModified', function(e) {
            bootbox.alert({
                title: "GeoJSON",
                message: e.detail.feature
            });
        });
        document.addEventListener('addressSelected', function(e) {
            var geojson = {
                "type": "FeatureCollection",
                "features": [{
                    "type": "Feature",
                    "properties": {
                        "ads_oid": e.detail.ads_oid,
                        "orig_tunnus": e.detail.orig_tunnus,
                        "paadress": e.detail.paadress
                    },
                    "geometry": {
                        "type": "Point",
                        "coordinates": [
                            e.detail.l,
                            e.detail.b
                        ]
                    }
                }]
            };

            bootbox.dialog({
                title: "GeoJSON",
                message: JSON.stringify(geojson, null, 2)
            });
            //            window.setTimeout(function() {
            //                bootbox.hideAll();
            //            }, 3000);
        });
    </script>
</body>

</html>
